---
title: Enable optimized moves of redirected folders
description: How to perform an optimized move of redirected folders to a new file share.
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.date: 09/10/2018
ms.localizationpriority: medium
---
# Enable optimized moves of redirected folders

>Applies to: Windows 10, Windows 8, Windows 8.1, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server (Semi-annual Channel)

This topic describes how to perform an optimized move of redirected folders (Folder Redirection) to a new file share. If you enable this policy setting, when an administrator moves the file share hosting redirected folders and updates the target path of the redirected folders in Group Policy, the cached content is simply renamed in the local Offline Files cache without any delays or potential data loss for the user.

Previously, administrators could change the target path of the redirected folders in Group Policy and let the client computers copy the files at the affected user's next sign in, causing a delayed sign in. Alternatively, administrators could move the file share and update the target path of the redirected folders in Group Policy. However, any changes made locally on the client computers between the start of the move and the first sync after the move would be lost.

## Prerequisites

Optimized move has the following requirements:

- Folder Redirection must be setup. For more information see [Deploy Folder Redirection with Offline Files](deploy-folder-redirection.md).
- Client computers must run Windows 10, Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 or Windows Server (Semi-annual Channel).

## Step 1: Enable optimized move in Group Policy

To optimize the relocation of Folder Redirection data, use Group Policy to enable the **Enable optimized move of contents in Offline Files cache on Folder Redirection server path change** policy setting for the appropriate Group Policy Object (GPO). Configuring this policy setting to **Disabled** or **Not Configured** causes the client to copy all the Folder Redirection content to the new location and then delete the content from the old location if the server path changes.

Here's how to enable optimized moving of redirected folders:

1. In Group Policy Management, right-click the GPO you created for Folder Redirection settings (for example, **Folder Redirection and Roaming User Profiles Settings**), and then select **Edit**.
2. Under **User Configuration**, navigate to **Policies**, then **Administrative Templates**, then **System**, then **Folder Redirection**.
3. Right-click **Enable optimized move of contents in Offline Files cache on Folder Redirection server path change**, and then select **Edit**.
4. Select **Enabled**, and then select **OK**.

## Step 2: Relocate the file share for redirected folders

When moving the file share that contains users' redirected folders, it is important to take precautions to ensure that the folders are relocated properly.

>[!IMPORTANT]
>If the users' files are in use or if the full file state is not preserved in the move, users might experience poor performance as the files are copied over the network, synchronization conflicts generated by Offline Files, or even data loss.

1. Notify users in advance that the server hosting their redirected folders will change and recommend that they perform the following actions:

      - Synchronize the contents of their Offline Files cache and resolve any conflicts.
      - Open an elevated command prompt, enter **GpUpdate /Target:User /Force**, and then sign out and sign back in to ensure that the latest Group Policy settings are applied to the client computer

        >[!NOTE]
        >By default, client computers update Group Policy every 90 minutes, so if you allow sufficient time for client computers to receive updated policy, you do not need to ask users to use **GpUpdate**.
2. Remove the file share from the server to ensure that no files in the file share are in use. To do so in Server Manager, on the **Shares** page of File and Storage Services, right-click the appropriate file share, then select **Remove**.

    Users will work offline using Offline Files until the move is complete and they receive the updated Folder Redirection settings from Group Policy.

3. Using an account with backup privileges, move the contents of the file share to the new location using a method that preserves file timestamps, such as a backup and restore utility. To use the **Robocopy** command, open an elevated command prompt, and then type the following command, where ```<Source>``` is the current location of the file share, and ```<Destination>``` is the new location:

    ```PowerShell
    Robocopy /B <Source> <Destination> /Copyall /MIR /EFSRAW
    ```

    >[!NOTE]
    >The **Xcopy** command does not preserve all of the file state.
4. Edit the Folder Redirection policy settings, updating the target folder location for each redirected folder that you want to relocate. For more information, see Step 4 of [Deploy Folder Redirection with Offline Files](deploy-folder-redirection.md).
5. Notify users that the server hosting their redirected folders has changed, and that they should use the **GpUpdate /Target:User /Force** command, and then sign out and sign back in to get the updated configuration and resume proper file synchronization.

    Users should sign on to all machines at least once to ensure that the data gets properly relocated in each Offline Files cache.

## More information

* [Deploy Folder Redirection with Offline Files](deploy-folder-redirection.md)
* [Deploy Roaming User Profiles](deploy-roaming-user-profiles.md)
* [Folder Redirection, Offline Files, and Roaming User Profiles overview](folder-redirection-rup-overview.md)